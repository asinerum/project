var SVM=function(e){var t=function(e){};function i(e){return function(t,i){for(var s=0,a=0;a<t.length;a++)s+=(t[a]-i[a])*(t[a]-i[a]);return Math.exp(-s/(2*e*e))}}function s(e,t){for(var i=0,s=0;s<e.length;s++)i+=e[s]*t[s];return i}return t.prototype={train:function(e,t,a){this.data=e,this.labels=t;var r=(a=a||{}).C||1,n=a.tol||1e-4,h=a.alphatol||1e-7,l=a.maxiter||1e4,o=a.numpasses||10,u=s;if(this.kernelType="linear","kernel"in a)if("string"==typeof a.kernel){if("linear"===a.kernel&&(this.kernelType="linear",u=s),"rbf"===a.kernel){var f=a.rbfsigma||.5;this.rbfSigma=f,this.kernelType="rbf",u=i(f)}}else this.kernelType="custom",u=a.kernel;this.kernel=u,this.N=e.length;var p=this.N;this.D=e[0].length;this.D;if(this.alpha=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t}(p),this.b=0,this.usew_=!1,a.memoize){this.kernelResults=new Array(p);for(var k=0;k<p;k++){this.kernelResults[k]=new Array(p);for(var b=0;b<p;b++)this.kernelResults[k][b]=u(e[k],e[b])}}for(var m,v,g=0,c=0;c<o&&g<l;){var y=0;for(k=0;k<p;k++){var j=this.marginOne(e[k])-t[k];if(t[k]*j<-n&&this.alpha[k]<r||t[k]*j>n&&this.alpha[k]>0){for(b=k;b===k;)m=0,v=this.N,b=Math.floor(Math.random()*(v-m)+m);var d=this.marginOne(e[b])-t[b];ai=this.alpha[k],aj=this.alpha[b];var w=0,R=r;if(t[k]===t[b]?(w=Math.max(0,ai+aj-r),R=Math.min(r,ai+aj)):(w=Math.max(0,aj-ai),R=Math.min(r,r+aj-ai)),Math.abs(w-R)<1e-4)continue;var T=2*this.kernelResult(k,b)-this.kernelResult(k,k)-this.kernelResult(b,b);if(T>=0)continue;var N=aj-t[b]*(j-d)/T;if(N>R&&(N=R),N<w&&(N=w),Math.abs(aj-N)<1e-4)continue;this.alpha[b]=N;var D=ai+t[k]*t[b]*(aj-N);this.alpha[k]=D;var M=this.b-j-t[k]*(D-ai)*this.kernelResult(k,k)-t[b]*(N-aj)*this.kernelResult(k,b),S=this.b-d-t[k]*(D-ai)*this.kernelResult(k,b)-t[b]*(N-aj)*this.kernelResult(b,b);this.b=.5*(M+S),D>0&&D<r&&(this.b=M),N>0&&N<r&&(this.b=S),y++}}g++,0==y?c++:c=0}if("linear"===this.kernelType){this.w=new Array(this.D);for(b=0;b<this.D;b++){var O=0;for(k=0;k<this.N;k++)O+=this.alpha[k]*t[k]*e[k][b];this.w[b]=O,this.usew_=!0}}else{var A=[],x=[],_=[];for(k=0;k<this.N;k++)this.alpha[k]>h&&(A.push(this.data[k]),x.push(this.labels[k]),_.push(this.alpha[k]));this.data=A,this.labels=x,this.alpha=_,this.N=this.data.length}var z={};return z.iters=g,z},marginOne:function(e){var t=this.b;if(this.usew_)for(var i=0;i<this.D;i++)t+=e[i]*this.w[i];else for(var s=0;s<this.N;s++)t+=this.alpha[s]*this.labels[s]*this.kernel(e,this.data[s]);return t},predictOne:function(e){return this.marginOne(e)>0?1:-1},margins:function(e){for(var t=e.length,i=new Array(t),s=0;s<t;s++)i[s]=this.marginOne(e[s]);return i},kernelResult:function(e,t){return this.kernelResults?this.kernelResults[e][t]:this.kernel(this.data[e],this.data[t])},predict:function(e){for(var t=this.margins(e),i=0;i<t.length;i++)t[i]=t[i]>0?1:-1;return t},getWeights:function(){for(var e=new Array(this.D),t=0;t<this.D;t++){for(var i=0,s=0;s<this.N;s++)i+=this.alpha[s]*this.labels[s]*this.data[s][t];e[t]=i}return{w:e,b:this.b}},toJSON:function(){return"custom"===this.kernelType?(console.log("Can't save this SVM because it's using custom, unsupported kernel..."),{}):(json={},json.N=this.N,json.D=this.D,json.b=this.b,json.kernelType=this.kernelType,"linear"===this.kernelType&&(json.w=this.w),"rbf"===this.kernelType&&(json.rbfSigma=this.rbfSigma,json.data=this.data,json.labels=this.labels,json.alpha=this.alpha),json)},fromJSON:function(e){this.N=e.N,this.D=e.D,this.b=e.b,this.kernelType=e.kernelType,"linear"===this.kernelType?(this.w=e.w,this.usew_=!0,this.kernel=s):"rbf"==this.kernelType?(this.rbfSigma=e.rbfSigma,this.kernel=i(this.rbfSigma),this.data=e.data,this.labels=e.labels,this.alpha=e.alpha):console.log("ERROR! unrecognized kernel type."+this.kernelType)}},(e=e||{}).SVM=t,e.makeRbfKernel=i,e.linearKernel=s,e}("undefined"!=typeof module&&module.exports);SVM.options={"C":1,"tol":0.0001,"alphatol":0.0000001,"maxiter":10000,"numpasses":10};
var svm=function(data,labels,config=SVM.options,f){f=(new SVM.SVM());f.train(data,labels,config);return(f)};