var NB=function(t){return new Naivebayes(t)},STATE_KEYS=NB.STATE_KEYS=["categories","docCount","totalDocuments","vocabulary","vocabularySize","wordCount","wordFrequencyCount","options"];NB.fromJson=function(t){var o;try{o=JSON.parse(t)}catch(t){throw new Error("Naivebayes.fromJson expects a valid JSON string.")}var e=new Naivebayes(o.options);return STATE_KEYS.forEach((function(t){if(void 0===o[t]||null===o[t])throw new Error("Naivebayes.fromJson: JSON string is missing an expected property: `"+t+"`.");e[t]=o[t]})),e};var defaultTokenizer=function(t){return t.replace(/[^(a-zA-ZA-Яa-я0-9_)+\s]/g," ").split(/\s+/)};function Naivebayes(t){if(this.options={},void 0!==t){if(!t||"object"!=typeof t||Array.isArray(t))throw TypeError("NaiveBayes got invalid `options`: `"+t+"`. Pass in an object.");this.options=t}this.tokenizer=this.options.tokenizer||defaultTokenizer,this.vocabulary={},this.vocabularySize=0,this.totalDocuments=0,this.docCount={},this.wordCount={},this.wordFrequencyCount={},this.categories={}}Naivebayes.prototype.initializeCategory=function(t){return this.categories[t]||(this.docCount[t]=0,this.wordCount[t]=0,this.wordFrequencyCount[t]={},this.categories[t]=!0),this},Naivebayes.prototype.learn=async function(t,o){var e=this;e.initializeCategory(o),e.docCount[o]++,e.totalDocuments++;var r=await e.tokenizer(t),n=e.frequencyTable(r);return Object.keys(n).forEach((function(t){e.vocabulary[t]||(e.vocabulary[t]=!0,e.vocabularySize++);var r=n[t];e.wordFrequencyCount[o][t]?e.wordFrequencyCount[o][t]+=r:e.wordFrequencyCount[o][t]=r,e.wordCount[o]+=r})),e},Naivebayes.prototype.categorize=async function(t){var o=this,e=-1/0,r=null,n=await o.tokenizer(t),a=o.frequencyTable(n);return Object.keys(o.categories).forEach((function(t){var n=o.docCount[t]/o.totalDocuments,i=Math.log(n);Object.keys(a).forEach((function(e){var r=a[e],n=o.tokenProbability(e,t);i+=r*Math.log(n)})),i>e&&(e=i,r=t)})),r},Naivebayes.prototype.tokenProbability=function(t,o){return((this.wordFrequencyCount[o][t]||0)+1)/(this.wordCount[o]+this.vocabularySize)},Naivebayes.prototype.frequencyTable=function(t){var o=Object.create(null);return t.forEach((function(t){o[t]?o[t]++:o[t]=1})),o},Naivebayes.prototype.toJson=function(){var t={},o=this;return STATE_KEYS.forEach((function(e){t[e]=o[e]})),JSON.stringify(t)};Naivebayes.prototype.predict=Naivebayes.prototype.categorize;/*promise*/
var naivebayes=function(data,labels,p=[],n){n=NB();data.forEach((e,i)=>{p.push(n.learn(e,labels[i]))});return(Promise.all(p).then(function(){return(n)}))};/*promise*/