var distances={euclidean:function(r,n){for(var t=0,a=0;a<r.length;a++)t+=Math.pow(n[a]-r[a],2);return Math.sqrt(t)},manhattan:function(r,n){for(var t=0,a=0;a<r.length;a++)t+=Math.abs(n[a]-r[a]);return t},max:function(r,n){for(var t=0,a=0;a<r.length;a++)t=Math.max(t,Math.abs(n[a]-r[a]));return t}};function randomCentroids(r,n){var t=r.slice(0);return t.sort((function(){return Math.round(Math.random())-.5})),t.slice(0,n)}function closestCentroid(r,n,t){for(var a=1/0,e=0,o=0;o<n.length;o++){var h=t(r,n[o]);h<a&&(a=h,e=o)}return e}function kmeans(r,n,t,a,e){n=n||Math.max(2,Math.ceil(Math.sqrt(r.length/2))),"string"==typeof(t=t||"euclidean")&&(t=distances[t]);for(var o=randomCentroids(r,n),h=new Array(r.length),i=new Array(n),l=0,s=!0;s;){for(var f=0;f<r.length;f++)h[f]=closestCentroid(r[f],o,t);s=!1;for(var u=0;u<n;u++){var c=[];for(f=0;f<h.length;f++)h[f]==u&&c.push(r[f]);if(c.length){for(var g=o[u],v=new Array(g.length),d=0;d<g.length;d++){var M=0;for(f=0;f<c.length;f++)M+=c[f][d];v[d]=M/c.length,v[d]!=g[d]&&(s=!0)}o[u]=v,i[u]=c}}e&&l++%a==0&&e(i)}return i}